{
  'targets': [
    {
      'target_name': 'binding',
      'defines': [ 'V8_DEPRECATION_WARNINGS=1' ],
      'sources': [ 'wavoip.cc' ],
      'cflags!': [ '-fno-exceptions' ],
      'cflags_cc!': [ '-fno-exceptions' ],
      'conditions': [
        ['OS=="mac"', {
          'sources': [ 'binding.cc', 'binding_details.cc', 'crypto/darwin/WAHKDF.mm', 'crypto/darwin/crypto.mm' ],
          'xcode_settings': {
            'GCC_ENABLE_CPP_EXCEPTIONS': 'YES',
            'CLANG_ENABLE_OBJC_ARC': 'YES',
            'MACOSX_DEPLOYMENT_TARGET': '10.12',
            'OTHER_CPLUSPLUSFLAGS': [
              "-std=c++14",
              "-stdlib=libc++"
            ],
          },
          'include_dirs': [
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/pjlib-util/include',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/pjlib/include',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/pjmedia/include',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/third_party/build/resample',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/third_party/build/srtp',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/third_party/libyuv/include',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/third_party/resample/include',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/third_party/srtp/include',
            '<!(echo $VOIP_REPO_PATH)/third_party/protobuf',
            '<!(echo $VOIP_REPO_PATH)/pjproject-2.2.1/webrtc/modules/remote_bitrate_estimator/include',
            '<!(echo $VOIP_REPO_PATH)/webrtc/trunk-svn6137-05-14-14/webrtc/..',
            '<!(echo $VOIP_REPO_PATH)/platforms/common'
          ],
          'libraries': [
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libminiupnpc.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libopus_v1_3.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libpjlib.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libpjlib_util.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libpjmedia.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libsamplerate.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libsrtp_2.2.0.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libvpx.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libvpx_g.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_aec_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_aecm_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_agc_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_codecs_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_fec.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_ns_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_rbe_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_spl_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_system_wrappers_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_aec_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwebrtc_utility_v2.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libyuv_static.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libmac-avdriver.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwa_voip_protobuf-schema.a',
            '<!(echo $VOIP_BUILD_PATH)/darwin/wavoiplib/libwa_voip_protobuf-c.a',
            '-framework Foundation',
            '-framework CoreFoundation',
            '-framework CFNetwork',
            '-framework AudioUnit',
            '-framework AudioToolbox',
            '-framework VideoToolbox',
            '-framework CoreAudio',
            '-framework CoreVideo',
            '-framework CoreMedia',
            '-framework Accelerate',
            '-framework Security',
            '-framework AVFoundation',
          ],
        },
        'OS=="linux"', {
          'sources': [ 'binding_linux.cc' ],
        },
        'OS=="win"', {
          'sources': [ 'binding.cc', 'binding_details.cc', 'crypto/win32/crypto_impl.cc', 'crypto/win32/crypto.cc' ],
          'defines': [
            '_WINDOWS=1',
          ],
          'include_dirs': [
            '$(VOIP_REPO_PATH)/pjproject-2.2.1',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/pjlib-util/include',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/pjlib/include',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/pjmedia/include',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/third_party/build/resample',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/third_party/build/srtp',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/third_party/libyuv/include',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/third_party/resample/include',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/third_party/srtp/include',
            '$(VOIP_REPO_PATH)/third_party/protobuf',
            '$(VOIP_REPO_PATH)/pjproject-2.2.1/webrtc/modules/remote_bitrate_estimator/include',
            '$(VOIP_REPO_PATH)/webrtc/trunk-svn6137-05-14-14/webrtc/..',
            '$(VOIP_REPO_PATH)/platforms/common',
          ],
          'libraries': [
            'bcrypt.lib',
            'windowsapp.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/opus_v1_3.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/pjlib.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/pjlib_util.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/pjmedia.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/samplerate.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/srtp_2.2.0.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/vpx.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/wa_voip.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_aec_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_aecm_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_agc_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_codecs_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_fec.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_ns_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_rbe_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_spl_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_system_wrappers_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_utility_v2.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/yuv_static.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/zlibstatic.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/zlib.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/windows-avdriver.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_pacing.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/wa_voip_protobuf-schema.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/wa_voip_protobuf-c.lib',
            '$(VOIP_BUILD_PATH)/win32/wavoiplib/webrtc_aec3_ns.lib',
          ],
          "configurations": {
            'Debug': {
              'msvs_settings': {
                'VCCLCompilerTool': {
                  # 0 - MultiThreaded (/MT)
                  # 1 - MultiThreadedDebug (/MTd)
                  # 2 - MultiThreadedDLL (/MD)
                  # 3 - MultiThreadedDebugDLL (/MDd)
                  'RuntimeLibrary': 3,
                  'ExceptionHandling': 1
                }
              }
            },
            'Release': {
              'msvs_settings': {
                'VCCLCompilerTool': {
                  'RuntimeLibrary': 2,
                  'ExceptionHandling': 1
                },
              },
            },
          },
        }]
      ],
      'include_dirs': [
        "<!(node -e \"require('nan')\")",
      ],
    }
  ]
}
