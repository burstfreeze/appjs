
if ($args.Count -ne 3) {
    Write-Host "Please provide following arguments"
    Write-Host "Debug, Release, RelWithDebInfo"
    Write-Host "voip repo path"
    Write-Host "wajs repo path"
    Write-Host "ex: ./copy.ps1 Debug ~/git/voip ~/git/wajs"
    return
}

$config=$args[0]
$voip=$args[1]
$wajs=$args[2]

$destination = "$wajs\web\custom_modules\wavoip\win32\wavoiplib"

if (($config -ne "Debug") -and ($config -ne "Release") -and ($config -ne "RelWithDebInfo")) {
    Write-Host "Only Debug, Release or RelWithDebInfo"
    return
}

$libs = @("opus_1.3", "pjlib", "pjlib_util", "pjmedia", "samplerate", "wafbsource__libsrtp", "vpx_1.8.1", "webrtc_aec_v2", "webrtc_aecm_v2", "webrtc_agc_v2", "webrtc_codecs_v2", "webrtc_fec", "webrtc_ns_v2", "webrtc_rbe_v2", "webrtc_spl_v2", "webrtc_sw_v2", "webrtc_utility_v2", "yuv-1704", "windows-avdriver", "webrtc_pacing", "wafbsource__webrtc_m89", "wacall_foundation", "wacall_system", "wafbsource__openh264common", "wafbsource__openh264dec", "wafbsource__openh264enc", "wafbsource__openh264processing")

# delete first
Get-ChildItem -Path $destination -Include *.* -File -Recurse | ForEach-Object { $_.Delete()}

# copy libs expect zlib
foreach ($lib in $libs) {
    Copy-Item "$voip\build\$config\x86_64\wavoip\$lib\$config\*" -Destination $destination -Recurse -Force -Verbose
}

# copy wa_voip.lib, TODO: I think it is not needed.
Copy-Item "$voip\build\$config\x86_64\wavoip\$config\*" -Destination $destination -Recurse -Force -Verbose

# copy wa_voip_protobuf-schema, wa_voip_protobuf-c
Copy-Item "$voip\build\$config\x86_64\wavoip\protobuf\$config\wa_voip_protobuf-schema.lib" -Destination "$destination\wa_voip_protobuf-schema.lib" -Force -Verbose
Copy-Item "$voip\build\$config\x86_64\wavoip\protobuf\$config\wa_voip_protobuf-c.lib" -Destination "$destination\wa_voip_protobuf-c.lib" -Force -Verbose
Copy-Item "$voip\build\$config\x86_64\wavoip\protobuf\pdb\$config\wa_voip_protobuf-schema.pdb" -Destination "$destination\wa_voip_protobuf-schema.pdb" -Force -Verbose
Copy-Item "$voip\build\$config\x86_64\wavoip\protobuf\pdb\$config\wa_voip_protobuf-c.pdb" -Destination "$destination\wa_voip_protobuf-c.pdb" -Force -Verbose

# copy zlib
if ($config -eq "Debug") {
    Copy-Item "$voip\build\$config\x86_64\wavoip\zlib\$config\zlibd.lib" -Destination "$destination\zlib.lib" -Force -Verbose
    Copy-Item "$voip\build\$config\x86_64\wavoip\zlib\$config\zlibd.pdb" -Destination "$destination\zlib.pdb" -Force -Verbose
    Copy-Item "$voip\build\$config\x86_64\wavoip\zlib\$config\zlibstaticd.lib" -Destination "$destination\zlibstatic.lib" -Force -Verbose
} else {
    Copy-Item "$voip\build\$config\x86_64\wavoip\zlib\$config\zlib.lib" -Destination $destination -Force -Verbose
    Copy-Item "$voip\build\$config\x86_64\wavoip\zlib\$config\zlibstatic.lib" -Destination $destination -Force -Verbose
}

# copy pdb for RelWithDebInfo or Debug
if ($config -ne "Release") {
    foreach ($lib in $libs) {
        Copy-Item "$voip\build\$config\x86_64\wavoip\$lib\pdb\$config\*" -Destination $destination -Recurse -Force -Verbose
    }
}
